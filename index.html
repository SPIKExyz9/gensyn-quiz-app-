let animId=null; function animate(){ if(animId) cancelAnimationFrame(animId); function frame(){ctx.clearRect(0,0,W,H); for(let p of particles){p.x+=p.vx; p.y+=p.vy; p.vy+=0.25; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size); ctx.restore();} particles = particles.filter(p=>p.y < H+50); if(particles.length>0) animId=requestAnimationFrame(frame); else cancelAnimationFrame(animId);} frame();}

// audio using WebAudio API
const AudioCtx = window.AudioContext || window.webkitAudioContext; const ac = new AudioCtx();
function playTone(freq,duration=0.15, type='sine'){const o=ac.createOscillator();const g=ac.createGain();o.type=type;o.frequency.value=freq;g.gain.value=0.06;o.connect(g);g.connect(ac.destination);o.start();g.gain.exponentialRampToValueAtTime(0.00001,ac.currentTime+duration);o.stop(ac.currentTime+duration+0.02);} 
function playWinSound(win){ if(win){ playTone(880,0.12,'sine'); setTimeout(()=>playTone(660,0.12,'sine'),120); setTimeout(()=>playTone(1320,0.12,'sine'),260);} else { playTone(220,0.18,'sawtooth'); }}

// subtle UI sound on opt select
document.addEventListener('click', (e)=>{ if(e.target.closest('.opt')) playTone(880,0.06); if(e.target.id==='next') playTone(660,0.05); if(e.target.id==='prev') playTone(500,0.05); });

// keyboard support (for accessibility on mobile keyboard accessory)
addEventListener('keydown',(e)=>{ if(e.key==='ArrowRight') document.getElementById('next').click(); if(e.key==='ArrowLeft') document.getElementById('prev').click(); });

// small onboarding: animate CTA
(function introPulse(){ const cta = document.getElementById('startBtn'); cta.animate([{transform:'translateY(0) scale(1)'},{transform:'translateY(-6px) scale(1.03)'}],{duration:1200,iterations:Infinity,direction:'alternate',easing:'ease-in-out'}); })();

// random logo text injection spikes
(function brandSpark(){ const logo = document.querySelector('.logo'); logo.textContent = 'SX'; const gg = document.createElement('div'); gg.className='spark pulse'; gg.innerHTML = '<svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="6" stroke="white" stroke-opacity="0.08" stroke-width="1"/><path d="M12 3v3M12 18v3M3 12h3M18 12h3M4.5 4.5l2 2M17.5 17.5l2 2M17.5 6.5l2-2M4.5 19.5l2-2" stroke="white" stroke-opacity="0.12" stroke-width="0.8"/></svg>'; document.querySelector('.brand').appendChild(gg); })();

// Auto-save progress to localStorage (so mobile users can continue)
setInterval(()=>{ localStorage.setItem('spikexyz_progress', JSON.stringify(state)); updateScoreBadge(); },5000);
// load
(function loadProgress(){ const saved = localStorage.getItem('spikexyz_progress'); if(saved){ try{ const s = JSON.parse(saved); if(s && s.idx>=0) state=s; }catch(e){} } updateScoreBadge(); })();

// quick accessibility: focus first option after render
const obs = new MutationObserver(()=>{ const opt = document.querySelector('.opt'); if(opt) opt.setAttribute('tabindex',0); }); obs.observe(quizFrame,{childList:true,subtree:true});

</script>
</body>
</html>
